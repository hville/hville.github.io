<!doctype html>
<html lang=en>
<head>
	<title>monte carlo</title>
	<meta charset=utf-8>
	<meta name=viewport content="width=device-width, initial-scale=1.0">
	<meta name=description content="in browser benchmarking">
	<link rel="stylesheet" href="../_src/main.css">
	<link href="https://unpkg.com/prismjs@1.24.1/themes/prism.css" rel="stylesheet" />
	<script type=module src="../_src/data-lang.js"></script>
</head>

<body>

<div style="display: flex; justify-content: space-between;">
	<h2>
		<a href="../">&#9884;</a> <span data-lang>monte carlo simulation // simulation monte carlo</span>
	</h2>
	<data-lang>en fr</data-lang>
</div>
<hr>

<details>
	<summary data-lang>templates and examples // exemples de modèles</summary>
	<li data-lang>
		<a lang=en href="./#en/Yyndvvm-eDptb9VQCD:/0Rw2UAb3._gP~K$s7*Mk_&QWcb5(~gL++4Zw0B,E97w(0CV6+X~EMv;F-d4KQIf!Bne0&@iABVkg@xrG">
		variable rate and duration investment
		</a>
		<a lang=fr href="./#fr/Yyndvvm-eDptb9VQCD:/0Rw2UAb3._gP~K$s7*Mk_&QWcb5(~gL++4Zw0B,E97w(0CV6+X~EMv;F-d4KQIf!Bne0&@iABVkg@xrG">
		investissement à durée et rendement variable
	</a></li>
</details>

<pre><code id=editor></code></pre>
<button id=run5e4>N = 5e4</button>
<button id=run5e5>N = 5e5</button>
<button id=run5e6>N = 5e6</button>
<pre><code id=result></code></pre>

<script type=module>
/*
	TODO
	instruction
	graph
 */
import {$, $$} from '/_npm/@hugov.inhtml.js'
import hashData from '../_src/hash-data.js'
import SIM from '/_npm/@hugov.correl-range.js'
import editable from '../_src/editable.js'
import parse from './parse.js'
import {CodeJar} from 'https://medv.io/codejar/codejar.js'

const resEl = $('#result')

const jar = CodeJar($('#editor'), j=>{
	resEl.textContent=''
})
// save / load
jar.onUpdate(hashData(code => {
	const pos = jar.save()
	jar.updateCode(code)
	jar.restore(pos)
}))

$('#run5e4').onclick = runSim.bind(null,5e4)
$('#run5e5').onclick = runSim.bind(null,5e5)
$('#run5e6').onclick = runSim.bind(null,5e6)

async function runSim(N) {
	let htm = resEl.textContent = ''
	try {
		await nextFrame()
		const
					fcn = parse(jar.toString()),
					ms0 = await nextFrame(),
					res = SIM(fcn).run(N).stats//,	ms1 = await nextFrame()
		htm += `${ (performance.now()-ms0).toFixed(0) } ms\n\n`
		Object.keys(res).forEach( k => {
			htm += `${k}  ( ${res[k].Q(.25).toPrecision(3)}  ${res[k].Q(.75).toPrecision(3)} )\n`
		})
	} catch (e) {
		htm += e.message
	}
	resEl.innerHTML = htm
}

function nextFrame() {
  return new Promise(r => requestAnimationFrame(r))
}

</script>
</body>
