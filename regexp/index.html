<!doctype html>
<html lang=en>
<head>
	<title>regexp</title>
	<meta charset=utf-8>
	<meta name=viewport content="width=device-width, initial-scale=1.0">
	<meta name=description content="word filter">
	<link rel="stylesheet" href="../_src/main.css">
	<script type=module src="../_src/data-lang.js"></script>
</head>

<body>

<div style="display: flex; justify-content: space-between;">
	<h2><a data-lang="el=>el.href=`/#${el.lang}`"><i><svg><use href="/icon.svg#dice"></use></svg></i></a> schem.ist</h2>
	<data-lang>en fr de es</data-lang>
</div>
<hr>

<!-- TODO
	<details>
	<summary data-lang>examples // exemples // Beispiele // ejemplos</summary>
	<li data-lang>
		<a lang=en href="./#en/1sqfEBX,BWl1Cs2xNv;j0kyVf~+tT?zJ,RFoq@j6OntNx_:MP/NMIpSj9s~2_F$kN&?i1hp2jjHE:/f)rbhwzJ/f+3wk0tm5Z=hrG">
		variable rate and duration investment
		</a>
		<a lang=fr href="./#fr/1sqfEBX,BWl1Cs2xNv;j0kyVf~+tT?zJ,RFoq@j6OntNx_:MP/NMIpSj9s~2_F$kN&?i1hp2jjHE:/f)rbhwzJ/f+3wk0tm5Z=hrG">
		investissement à durée et rendement variable
	</a></li>
</details>
 -->
<h3 data-lang>regex filter // filtre regex // Regex Filter // filtro regexp</h3>
<pre><textarea id=regexp rows=1 autofocus></textarea></pre>

<h3><span data-lang>results // résultats // Ergebnisse // resultados</span> (<span id=count>0</span>)</h3>
<pre id=result style=column-count:auto;column-width:30ch;></pre>

<script type=module>
import hashData from '../_src/hash-data.js'
import {$} from '/_npm/@hugov/inhtml.js' //$ = ids => document.getElementById(ids[0])

const regexpEl = $('#regexp'),
			countEl = $('#count'),
			resultEl = $('#result'),
			dics = {},
			max = 200 //TODO input

async function fetchList(lang) {
	const url = `https://raw.githubusercontent.com/lorenbrichter/Words/master/Words/${lang}.txt`
	return dics[lang] || (dics[lang] = (await (await fetch(url)).text()).trim().split(/[ ;,]*[\r\n]\s*/))
}

let last = '',
		wrkr

resetWorker()

function resetWorker() {
	if (wrkr) wrkr.terminate()
	wrkr = new Worker('./worker.js')
	wrkr.onerror = e => {
		showText(' ! ', e.message)
		resetWorker()
	}
	wrkr.onmessage = e => {
		const {list, code, lang} = e.data
		if (lang + code === last) showList(list)
	}
}
function showList(list) {
	resultEl.textContent = list.join('\n')
	countEl.textContent = list[max] === '...' ? `${list.length-1}...` : list.length
}
function showText(count, result) {
	resultEl.textContent = result
	countEl.textContent = count
}

const dohash = hashData(code => {
	if (!code) code = regexpEl.value
	else regexpEl.value = code
	const lang = document.documentElement.lang

	showText('...', '...')
	last = lang + code
	fetchList(lang)
		.then(dic => {
			wrkr.postMessage( {dic, code, lang, max} )
		 } )
		.catch( e => console.warn(e.message) )
})

regexpEl.oninput = evt => dohash(evt.currentTarget.value)

</script>
</body>
