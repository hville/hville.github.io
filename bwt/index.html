<!doctype html>
<html lang=en>
<head>
	<title>BWT => MTF => Elias γ</title>
	<meta charset=utf-8>
	<meta name=viewport content="width=device-width, initial-scale=1.0">
	<meta name=description content="word filter">
	<link rel="stylesheet" href="../_src/main.css">
	<script type=module src="../_src/data-lang.js"></script>
</head>

<body>

<div style="display: flex; justify-content: space-between;">
	<h2><a data-lang="el=>el.href=`/#${el.lang}`"><i><svg><use href="/icon.svg#dice"></use></svg></i></a> schem.ist</h2>
	<data-lang>en fr</data-lang>
</div>
<hr>

<h3 data-lang>source text // texte initial</h3>
<pre><textarea id=src rows=1 autofocus></textarea></pre>

<h3 data-lang>
	<span lang=en>
		<a href="https://en.wikipedia.org/wiki/Burrows%E2%80%93Wheeler_transform">
		Burrows–Wheeler transform (BWT)</a>
	</span>
	<span lang=fr>
		<a href="https://fr.wikipedia.org/wiki/Transform%C3%A9e_de_Burrows-Wheeler">
		Transformée de Burrows-Wheeler (BWT)</a>
	</span>
</h3>
<pre id=bwt></pre>

<h3 data-lang>
	<span lang=en>
		<a href="https://en.wikipedia.org/wiki/Move-to-front_transform">
		Move-to-front transform</a>
		<small>with [ a-z,.'":;\-?()[]{}\n!0-9+/*=_~&lt&ampgt^`#%\t$&@|\\A-Z]</small>
	</span>
	<span lang=fr>
		<a href="https://fr.wikipedia.org/wiki/Move-to-front">
		Transformée Move-to-front</a>
		<small>avec [ a-z,.'":;\-?()[]{}\n!0-9+/*=_~&lt&ampgt^`#%\t$&@|\\A-Z]</small>
	</span>
</h3>

<pre id=mtf></pre>

<h3 data-lang>
	<span lang=en>
		<a href="https://en.wikipedia.org/wiki/Elias_gamma_coding">
		Elias gamma coding
		</a>
	</span>
	<span lang=fr>
		<a href="https://fr.wikipedia.org/wiki/Codage_gamma">
		codage gamma d'Elias
		</a>
	</span>
</h3>
<pre id=egc></pre>

<h3 data-lang>
	<span lang=en>
		<a href="https://en.wikipedia.org/wiki/Base64">
		Base80 binary-to-text encoding</a>
		<small>with [0-9A-Za-z.\-_~,?!():;+/*=$&@]</small>
	</span>
	<span lang=fr>
		<a href="https://fr.wikipedia.org/wiki/Base64">
		Codage Base80</a>
		<small>avec [0-9A-Za-z.\-_~,?!():;+/*=$&@]</small>
	</a>
	</span>
</h3>
<pre id=enc></pre>

<script type=module>
import hashData from '../_src/hash-data.js'
import {$} from '/_npm/@hugov/inhtml.js' //$ = ids => document.getElementById(ids[0])
import {bwt, inv_bwt} from '/_npm/@hugov/shorter-string/src/bwt.js'
import {eMTF, dMTF} from '/_npm/@hugov/shorter-string/src/mtf.js'
import {UPPER, LOWER, DIGIT} from '/_npm/@hugov/shorter-string/src/charset.js'
import {enc, dec, QUERY} from '/_npm/@hugov/shorter-string.js'

const DIC = (' ' + LOWER + `,.'":;-?()[]{}\n!` + DIGIT + '+/*=_~<>^`#%\t$&@|\\' + UPPER).split('')

const $src = $('#src'),
			$bwt = $('#bwt'),
			$mtf = $('#mtf'),
			$egc = $('#egc'),
			$enc = $('#enc')

const dohash = hashData(src => {
	const b = bwt(src),
				m = eMTF(b, DIC),
				g = arr_big(m)
	$src.textContent = src
	$bwt.textContent = b
	$mtf.textContent = m
	$egc.textContent = g
	$enc.textContent = toString(g)
})

$src.oninput = evt => dohash(evt.target.value)

function arr_big(arr) {
	let res = 0n,
			j = arr.length
	while(j--) {
		let v = arr[j]+1, //increment to allow 0
				n = -1
		while (v) {
			res = v&1 ? (res << 1n) | 1n : (res << 1n)
			v >>>= 1
			++n
		}
		res <<= BigInt(n)
	}
	return res
}
function toString(big, keys=QUERY) {
	const len = BigInt(keys.length)
	let res = []
	do {
		res.unshift(keys[big%len])
		big /= len
	} while (big)
	return res.join('')
}

</script>
</body>
