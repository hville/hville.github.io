<!doctype html>
<html lang=en>
<head>
	<title data-lang>benchmark // banc d'essais</title>
	<meta charset=utf-8>
	<meta name=viewport content="width=device-width, initial-scale=1.0">
	<meta name=description content="in browser benchmarking">
	<link rel="stylesheet" href="../_src/main.css">
	<script type=module src="../_src/data-lang.js"></script>
</head>

<body>

<div style="display: flex; justify-content: space-between;">
	<h2><a data-lang="this.href=`/#${this.lang}`"><i><svg><use href="/icon.svg#dice"></use></svg></i></a> schem.ist</h2>
	<data-lang>en fr</data-lang>
</div>
<hr>

<details>
	<summary data-lang>templates and examples // exemples de modèles</summary>
	<li data-lang>
		<a lang=en href="./#en/63TKZ22w4olMzyRgLlL+op)runAd2FrSfA,D_2EZ5nUkwhnL9=A'Qp?w7=;7%?q#0HRuyur%j/K9tDvF:8qYjVUr-mgCP?BVFo;n/GKGb5Fk,~Nx7$3l$zP2W/Wt~a:v0LnitK&3fpVJ?2*,/9g!dU8zz,d&,jWTyj3*b2;!O&nhykX8?!,A5)l$=RW9nQ*qw3R%jll,w3it'vAy8*gUktLKqbHQxd5z)XqEhpDEC3U$t8DG1Ysj.4#GFskN;O+*F$$iq9FI+S4cWiDC8rg$.#!pm-Bh&(?1k4NfRhZOvRhw1/IR*E$bvK3m#48CQK8%J@oPF**guUbpybFmhSvdNPYUo3WK~+~2$~X_4Q!GC~z@yP~v'o~w~1OkJ9(E=V#6:rs@&WxMhvWX$5l.q(!95UulwP4#?N5">
		selecting a single element in a tree of 30
		</a>
		<a lang=fr href="./#fr/63TKZ22w4olMzyRgLlL+op)runAd2FrSfA,D_2EZ5nUkwhnL9=A'Qp?w7=;7%?q#0HRuyur%j/K9tDvF:8qYjVUr-mgCP?BVFo;n/GKGb5Fk,~Nx7$3l$zP2W/Wt~a:v0LnitK&3fpVJ?2*,/9g!dU8zz,d&,jWTyj3*b2;!O&nhykX8?!,A5)l$=RW9nQ*qw3R%jll,w3it'vAy8*gUktLKqbHQxd5z)XqEhpDEC3U$t8DG1Ysj.4#GFskN;O+*F$$iq9FI+S4cWiDC8rg$.#!pm-Bh&(?1k4NfRhZOvRhw1/IR*E$bvK3m#48CQK8%J@oPF**guUbpybFmhSvdNPYUo3WK~+~2$~X_4Q!GC~z@yP~v'o~w~1OkJ9(E=V#6:rs@&WxMhvWX$5l.q(!95UulwP4#?N5">
		selection par attribut d'un élément parmis 30 éléments
	</a></li>
	<li data-lang>
		<a lang=en href="./#en/5Z5j/)1E(uT-?n3HqCvLlTe%((:(*_W+AF/rm/N7468$Z~feE/14QO~~ZC:DhCa?aPiM'f~3wZ;6O*atE)c.s&&EExma~jz'vv@0BUas.,.e6HW?IKV_qsTr)ubo72@CJ4S;5-Wi(W)@p_rPvmM&ifK_nB=UR;VavP?QHyCrJWDwc7-VW!,rTRF~;rI_D~(TdZOgVGz,S;6iN)N'@QH'tukaz:e)O13S=*$Y,y6G91&m;5A_K4H'xoXOP,,ehkX3F5_iIU1,ZW8I4z_VlIFdHUcLZ$wayFcijd-X*wm*YV4Z4kD5FHZN!2ou*cv(eY7yu-41Hr6W_!'*gG$%2(n=MXEwgp;cl%tZS8B0rRgQ:wfYzCmcpmyA3(.3d_DQh?3$,cMZdi0n44V4%j2+YSy$!QL$!w-XAe@%-5ozNDi.z9=PNcgQ63Myziy">
		selecting elements in a tree of 30
		</a>
		<a lang=fr href="./#fr/5Z5j/)1E(uT-?n3HqCvLlTe%((:(*_W+AF/rm/N7468$Z~feE/14QO~~ZC:DhCa?aPiM'f~3wZ;6O*atE)c.s&&EExma~jz'vv@0BUas.,.e6HW?IKV_qsTr)ubo72@CJ4S;5-Wi(W)@p_rPvmM&ifK_nB=UR;VavP?QHyCrJWDwc7-VW!,rTRF~;rI_D~(TdZOgVGz,S;6iN)N'@QH'tukaz:e)O13S=*$Y,y6G91&m;5A_K4H'xoXOP,,ehkX3F5_iIU1,ZW8I4z_VlIFdHUcLZ$wayFcijd-X*wm*YV4Z4kD5FHZN!2ou*cv(eY7yu-41Hr6W_!'*gG$%2(n=MXEwgp;cl%tZS8B0rRgQ:wfYzCmcpmyA3(.3d_DQh?3$,cMZdi0n44V4%j2+YSy$!QL$!w-XAe@%-5ozNDi.z9=PNcgQ63Myziy">
		selection par attribut d'un groupe d'éléments parmis 30 éléments
	</a></li>
	<li data-lang>
		<a lang=en href="./#en/G(4*ZnG9-K1I(vOL)mFvr.m'uc,oUQMwYG_,5?~o08)NBRyM(W!H4C/M33=f7,KUpnPqcV*nz,oqxjvY=L-Rbot:DDJ58b4Mvsm:XG3da/3a8SWk0wcHl7Se~f,z',VY_p$PIQo_e&&FE#eL$6t@:6,!AHNTO7s,~Hlb7t;fX*jpt4GTGEvf*=3uyne~1E=bOfT(rVHo1.;9#u;c3je!Cwt4(?MpbTkq.D+=4%FaA,@XgDurJ9xO'ByAp(DBTA/oRJ=Pp70~wfm;Vd0o%&">
		iterating through object keys and values
		</a>
		<a lang=fr href="./#fr/G(4*ZnG9-K1I(vOL)mFvr.m'uc,oUQMwYG_,5?~o08)NBRyM(W!H4C/M33=f7,KUpnPqcV*nz,oqxjvY=L-Rbot:DDJ58b4Mvsm:XG3da/3a8SWk0wcHl7Se~f,z',VY_p$PIQo_e&&FE#eL$6t@:6,!AHNTO7s,~Hlb7t;fX*jpt4GTGEvf*=3uyne~1E=bOfT(rVHo1.;9#u;c3je!Cwt4(?MpbTkq.D+=4%FaA,@XgDurJ9xO'ByAp(DBTA/oRJ=Pp70~wfm;Vd0o%&">
		iteration sur l'ensemble des clés et valeurs d'un objet
		</a></li>
</details>

<table>
<!-- TODO table caption ? -->
<colgroup>
	<col style="width:75%;">
	<col>
</colgroup>
<thead>
	<tr>
		<th data-lang>imports and setup // imports et initialisation</th>
	</tr>
	<tr>
		<td>
			<pre><code id=init contenteditable=true></code></pre>
		</td>
		<td style="text-align: center; vertical-align: middle;">
			<button id=run data-lang>
				<span lang=en>run tests!<br>(takes a few seconds)</span>
				<span lang=fr>exécution!<br>(quelques secondes)</span>
			</button>
		</td>
	</tr>
	<tr>
		<th>code</th>
		<th style="text-align: center; vertical-align: middle; white-space: pre-wrap;">quartiles (Hz)</th>
	</tr>
</thead>

<tbody></tbody>

</table>
<template>
	<tr id=row>
		<td>
			<pre><code id=code contenteditable=true></code></pre>
		</td>
		<td style="text-align: center; vertical-align: middle;">
			<out id=time style="white-space: pre-wrap;"></out>
		</td>
	</tr>
</template>

<script type=module>

import {cast, frame, $, $$} from '/_npm/@hugov/inhtml.js'
import hashData from '../_src/hash-data.js'
import editable from '../_src/editable.js'

const init = $('#init'),
			tbody = $('tbody'),
			rows = tbody.children

// row factory
const makeRow = cast('template', ({row, code, time}, codeVal='') => {
	editable(code)
	code.textContent = codeVal
	time.update = res => time.textContent = !res ? '' : res.map( v => v.toPrecision(3) ).join('  ')
	code.onchange = () => {
		time.textContent = ''
		if (!code.textContent) row.remove()
		else if (!row.nextSibling) row.after(makeRow())
		save()
	}
	row.$ids = {code, time}
	return row
})


// simulation button handler
$('#run').onclick = () => {
	const initCode = `import bench from '/_npm/@hugov/bench.js';${ init.textContent };`
	const execCode = `()=>bench([${
		Array.from(rows).slice(0,-1).map( row => `function(){${row.$ids.code.textContent}}` ).join(',\n')
	}])`
	const sandbox = frame( execCode, initCode, 'type=module' )
	sandbox.then(async framedFcn => {
		const res = await framedFcn()
		framedFcn.remove()
		Array.from(rows).forEach( ({$ids}, i) => $ids.time.update( res[i] ) )
	}).catch( err => console.log('error in test', err) )
}

// save / load
const saveData = hashData( ({data, lang}) => {
	if (rows.length) tbody.textContent = '' //reset rows
	if (data) {
		const itms = data.split('\v') //vertial tab as seperator
		init.textContent = itms.shift()
		itms.forEach( code => { if (code) tbody.append(makeRow(code)) } )
	}
	// one last empty line to allow adding new lines
	tbody.appendChild( makeRow() )
})

function save() {
	//TODO might be easier to to all rows and replace last with init
	const values = [init.textContent]
	//get all rows but the last
	for (let i=0; i<rows.length-1; ++i) values.push(rows[i].$ids.code.textContent)
	saveData( {data: values.join('\v')} )
}
editable(init)
init.onchange = save
</script>
</body>
