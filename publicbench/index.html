<!doctype html>
<html lang=en>
<head>
	<title data-lang>benchmark // banc d'essais</title>
	<meta charset=utf-8>
	<meta name=viewport content="width=device-width, initial-scale=1.0">
	<meta name=description content="in browser benchmarking">
	<link rel="stylesheet" href="../_src/main.css">
	<script type=module src="../_src/data-lang.js"></script>
</head>

<body>

<div style="display: flex; justify-content: space-between;">
	<h2><a href="../">&#9884;</a> <span data-lang>Javascript Benchmark // Banc d'essais javascript</span></h2>
	<data-lang>en fr</data-lang>
</div>
<hr>

<details>
	<summary data-lang>templates and examples // exemples de modèles</summary>
	<li data-lang>
		<a lang=en href="./#en/JoY@AB$I:F4c3m9mU-5A2XX5F3hMh;G.$_9=4rgPz3ZWUy$r!O_tyEuK=_dP8?HR0+r,zjcA7KRu:NxoorI&XVGe0VaT_Qk/7tJ5+aaCi0lXW2Oq0NYF&_=:sV3AveFBrrZLnWh!xlA@MWJfqjiGwufB,ptwTfHkl1nWyZbAt)=jL_6_jcWdbjRnM5=y~EpRF6IgVJ4Kwqk.7KJA3oi4q9QY~azkUht~Qx!Z(D/b23;D1E$:0t//9ED&isHKov,7m;vPBD!W6j@baRYk,@dy=DEBSC*lu_b5q@v~xitn4bO!1nTCd*_Do3+emA,!TR$x&v;+VNH*9GkKIEXvtAracz:_jEqYGnh$rS0H:EZ42h3LZk(NbXH33:lZRyWFLSn&4YRshcDU@b$*P-IKpLn,*LL37$=p8DgyJS=">
		selecting a single element in a tree of 30
		</a>
		<a lang=fr href="./#fr/JoY@AB$I:F4c3m9mU-5A2XX5F3hMh;G.$_9=4rgPz3ZWUy$r!O_tyEuK=_dP8?HR0+r,zjcA7KRu:NxoorI&XVGe0VaT_Qk/7tJ5+aaCi0lXW2Oq0NYF&_=:sV3AveFBrrZLnWh!xlA@MWJfqjiGwufB,ptwTfHkl1nWyZbAt)=jL_6_jcWdbjRnM5=y~EpRF6IgVJ4Kwqk.7KJA3oi4q9QY~azkUht~Qx!Z(D/b23;D1E$:0t//9ED&isHKov,7m;vPBD!W6j@baRYk,@dy=DEBSC*lu_b5q@v~xitn4bO!1nTCd*_Do3+emA,!TR$x&v;+VNH*9GkKIEXvtAracz:_jEqYGnh$rS0H:EZ42h3LZk(NbXH33:lZRyWFLSn&4YRshcDU@b$*P-IKpLn,*LL37$=p8DgyJS=">
		selection par attribut d'un élément parmis 30 éléments
	</a></li>
	<li data-lang>
		<a lang=en href="./#en/1QlKNCwu?FO_PdH/AHjaAs.sB69~aJLV*2SxxtV?EtNo2J3GuDsuI(Ek0OW~0&(i!/7wwB1L-uZAg;/YRp6DFNtrSef,,Cgf;cV;BoW.wi,xX(@Sj*!phA5LdCHO6qX~vW;qy6+B?_q2F3,k_K$VTEJ)FQmny@3y:H4mu&N4AGkPm+3V6@JYGZa9_sCiZ&68IBYl6WcC$;X5g~GJ_Z5mgAyeEmf=hoTU9MMLlvzaIpIJKbiABA*vYA/J,!c0~GQ7.DXm0=-zIUk*=b_C)R9-DbB;Tou2?_mf0n(dp~A*aRGlCX7(Oc?M_X3Iz~;fI;+XR;tMg,S5sSczr_UBR67$5:,_5J;zvK7.kgf&wP6FY~8b+K(a=E@1x&j3@y+aBh0S)!D-1-*!*qE,tI9=4X=pveg**BV-T)n(yw67oyqyc4*)5Q!H$20F$jJIr~0">
		selecting elements in a tree of 30
		</a>
		<a lang=fr href="./#fr/1QlKNCwu?FO_PdH/AHjaAs.sB69~aJLV*2SxxtV?EtNo2J3GuDsuI(Ek0OW~0&(i!/7wwB1L-uZAg;/YRp6DFNtrSef,,Cgf;cV;BoW.wi,xX(@Sj*!phA5LdCHO6qX~vW;qy6+B?_q2F3,k_K$VTEJ)FQmny@3y:H4mu&N4AGkPm+3V6@JYGZa9_sCiZ&68IBYl6WcC$;X5g~GJ_Z5mgAyeEmf=hoTU9MMLlvzaIpIJKbiABA*vYA/J,!c0~GQ7.DXm0=-zIUk*=b_C)R9-DbB;Tou2?_mf0n(dp~A*aRGlCX7(Oc?M_X3Iz~;fI;+XR;tMg,S5sSczr_UBR67$5:,_5J;zvK7.kgf&wP6FY~8b+K(a=E@1x&j3@y+aBh0S)!D-1-*!*qE,tI9=4X=pveg**BV-T)n(yw67oyqyc4*)5Q!H$20F$jJIr~0">
		selection par attribut d'un groupe d'éléments parmis 30 éléments
	</a></li>
	<li data-lang>
		<a lang=en href="./#en/z00zL:d&&mR9DWoQfW;ncXp,HSt3gi!FH/o;CE2,pYVg+uf:gzxH0Ra3O5+o;-WAtLv4i;r+DKpjycH(A8ZFR:v7w(O_LpKl&4Xqnk9&j_ckcOxlb(q=mDQfMw7)5jB2TscBI/-;~0m)AkJvEUIV4!qpzoxnx&Ev.k:d&.)g~U,GYOw4JiSr)7e9gp(Qgnq=c7t-gUwK?i9WNuSvK@qxMsxryMmAOcW_N$b4;!(m-b?Pq0t5kM3s7.7~3hdoikYaA+30tSfuHGW0fssP*3H0">
		iterating through object keys and values
		</a>
		<a lang=fr href="./#fr/z00zL:d&&mR9DWoQfW;ncXp,HSt3gi!FH/o;CE2,pYVg+uf:gzxH0Ra3O5+o;-WAtLv4i;r+DKpjycH(A8ZFR:v7w(O_LpKl&4Xqnk9&j_ckcOxlb(q=mDQfMw7)5jB2TscBI/-;~0m)AkJvEUIV4!qpzoxnx&Ev.k:d&.)g~U,GYOw4JiSr)7e9gp(Qgnq=c7t-gUwK?i9WNuSvK@qxMsxryMmAOcW_N$b4;!(m-b?Pq0t5kM3s7.7~3hdoikYaA+30tSfuHGW0fssP*3H0">
		iteration sur l'ensemble des clés et valeurs d'un objet
		</a></li>
</details>

<table>
<!-- TODO table caption ? -->
<colgroup>
	<col style="width:75%;">
	<col>
</colgroup>
<thead>
	<tr>
		<th data-lang>imports and setup // imports et initialisation</th>
	</tr>
	<tr>
		<td>
			<pre><code id=init contenteditable=true></code></pre>
		</td>
		<td style="text-align: center; vertical-align: middle;">
			<button id=run data-lang>
				<span lang=en>run tests!<br>(takes a few seconds)</span>
				<span lang=fr>exécution!<br>(quelques secondes)</span>
			</button>
		</td>
	</tr>
	<tr>
		<th>code</th>
		<th style="text-align: center; vertical-align: middle; white-space: pre-wrap;" data-lang>
			result in nanoseconds ( Q25   Q75 ) // résultats en nanosecondes ( Q25   Q75 )
		</th>
	</tr>
</thead>

<tbody></tbody>

</table>
<template>
	<tr id=row>
		<td>
			<pre><code id=code contenteditable=true></code></pre>
		</td>
		<td style="text-align: center; vertical-align: middle;">
			<out id=time style="white-space: pre-wrap;"></out>
		</td>
	</tr>
</template>

<script type=module>

import {cast, frame, $, $$} from '/_npm/@hugov.inhtml.js'
import hashData from '../_src/hash-data.js'
import editable from '../_src/editable.js'

const init = $('#init'),
			tbody = $('tbody'),
			rows = tbody.children

// row factory
const makeRow = cast('template', ({row, code, time}, codeVal='') => {
	editable(code)
	code.textContent = codeVal
	time.update = res => time.textContent = !res ? '' : `( ${ res.IQR.map( v => v.toPrecision(3) ).join('   ') } )`
	code.onchange = () => {
		time.textContent = ''
		if (!code.textContent) row.remove()
		else if (!row.nextSibling) row.after(makeRow())
		save()
	}
	row.$ids = {code, time}
	return row
})


// simulation button handler
$('#run').onclick = () => {
	const initCode = `import bench from 'https://cdn.skypack.dev/@hugov/bench@0.7.0';${ init.textContent };`
	const execCode = `()=>bench([${
		Array.from(rows).slice(0,-1).map( row => `function(){${row.$ids.code.textContent}}` ).join(',\n')
	}])`
	const sandbox = frame( execCode, initCode )
	sandbox.run()
	.then( res => Array.from(rows).forEach( ({$ids}, i) => $ids.time.update( res[i] ) ) )
	.catch( err => console.log('error in test', err) )
	.finally( () => sandbox.end() )
}

// save / load
const saveData = hashData(dataString => {
	if (rows.length) tbody.textContent = '' //reset rows
	if (dataString) {
		const data = dataString.split('\v') //vertial tab as seperator
		init.textContent = data.shift()
		data.forEach( code => { if (code) tbody.append(makeRow(code)) } )
	}
	// one last empty line to allow adding new lines
	tbody.appendChild( makeRow() )
})

function save() {
	//TODO might be easier to to all rows and replace last with init
	const values = [init.textContent]
	//get all rows but the last
	for (let i=0; i<rows.length-1; ++i) values.push(rows[i].$ids.code.textContent)
	saveData( values.join('\v') )
}
editable(init)
init.onchange = save
</script>
</body>
